<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¸­å›½èªã€€ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰</title>
  <style>
    .header2 {

      display: flex;
    }

    .linkurl {
      margin-left: auto;
    }

    #flash {
      display: inline-block;
      width: 170px;
      height: 40px;
      cursor: pointer;
      background-color: skyblue;
      text-decoration: none;
      text-align: center;
      line-height: 50px;
      border-radius: 6px
    }

    .result {
      font-size: 20px;
      margin-top: 20px;

    }

    #comment {
      margin-top: 5px;
      margin-bottom: 5px;
    }

    #answerInfo {
      display: flex;

    }

    #answerJp {
      margin: 0;
      margin-right: 10px;
    }

    #answerCh {
      margin: 0;
      margin-right: 10px;
      cursor: pointer;
      font-weight: bold;
    }

    #answerPin {
      margin: 0;

    }


    .totalGrade {
      padding-left: 30px;

      display: none;
      animation: 03s fadeIn;
    }

    .totalGradeDisplay {
      display: block;
    }

    .totalGradeNoDisplay {
      display: none;
    }

    #totalSeitouritsu {
      font-size: 24px;
    }

    #totalComment {
      font-size: 24px;
      color: red;
    }

    @keyframes fadeIn {
      0% {
        opacity: 0;
        transform: translateY(-10px);

      }

      100% {
        opacity: 1;
        transform: none;
      }

    }
  </style>
  <!--  ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®æƒ…å ±ã‚’èª­ã¿è¾¼ã‚€ãŸã‚ã«å¿…è¦ -->
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
</head>

<body>
  <div class="header">
    <div class="header2">
      <div class="logo">
        <h3>ä¸­å›½èªã€€ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰</h3>


      </div>

      <div class="linkurl">
        <!-- <a id="flash"
          href="https://script.google.com/macros/s/AKfycbwCL3tny-JoGZehVtlIoO5bAdv5MVrEG88dCRBJmFTwp5cPgYwnhXRgssoVwQmY6f0/exec"
          target="_blank">èªå¥ãƒ»æœ¬æ–‡ãƒ»æ–‡æ³•</a> -->
        <!-- <a id="ikeda" href="index6.Chinese" target="_blank">ä½¿ç”¨æ‰‹å¼•æ›¸</a> -->

      </div>
    </div>
    <!-- ã‚·ãƒ¼ãƒˆã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ -->
    <div class="sheetSelect">

      <label for="sheet-select">ã‚·ãƒ¼ãƒˆé¸æŠï¼š</label><select id="sheet-select" name="sheetSelect"></select>
    </div>
  </div>

  <img id="flashcard-image" width="250" height="250">
  <!-- <a href="https://drive.google.com/uc?id=1YiHQP2Nx8JguwgATMclWZI9FsvFhhpgl">yabo</a> -->
  <form class="formDisplay formDisplayNone">
    <input id="answer" type="text">
    <button id="chkInput">check</button>
    <p id="comment"></p>
  </form>
  <div id="answerInfo">
    <p id="answerJp"></p>
    <p id="answerCh" onclick="speakText1(this)"></p>
    <p id="answerPin"></p>


  </div>
  <div id="result" class="result resultNone">æ­£è§£: 0 å› ä¸æ­£è§£: 0 å›</div>
  <div class="totalGrade totalGradeNoDisplay">
    <p id="totalSeitouritsu"></p>
    <p id="totalComment"></p>

  </div>
  <script>
    let flashcardDatas;  // å…¨ã‚·ãƒ¼ãƒˆã®flashdata
    let flashCards;   // 1ã‚·ãƒ¼ãƒˆåˆ†ã®ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰
    let answerElement = document.getElementById('answer');
    let answerJp = document.getElementById('answerJp');
    let answerCh = document.getElementById('answerCh');
    let answerPin = document.getElementById('answerPin');
    // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã€€å˜èªã‚«ãƒ¼ãƒ‰3ã€€gas webã‚¢ãƒ—ãƒªã€€URL  å˜èªã‚«ãƒ¼ãƒ‰3
    const END_POINT = "https://script.google.com/macros/s/AKfycby18y0HghOzio74ermjxK7dGm8dvuIr3C1YM9YZOwy9-XYI5ovz9zyfxDW241A4uj-X/exec";

    // éåŒæœŸå‡¦ç†ã€€ã™ãƒ–ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®å˜èªã‚«ãƒ¼ãƒ‰èª­ã¿è¾¼ã¿é–¢æ•°
    // èª­ã¿è¾¼ã¿ãŒæˆåŠŸã™ã‚Œã°flashCardsã«ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã™ã‚‹ã€‚
    function flashcardYomikomi() {
      $.ajax({
        type: "GET",
        url: END_POINT,
        // data: { sheetNo: SHEET_NO }

      }).done((result) => {        // æˆåŠŸã—ãŸæ™‚ã®å‡¦ç†
        console.log("get done:" + result);
        setSheetNames(JSON.parse(result)[0]);

        flashcardDatas = JSON.parse(result);
        flashCards = JSON.parse(result)[1];
        showFlashcard();

        // flashCards2 = flashcardGenerate(flashCards);

      }).fail((error) => {  // å¤±æ•—ã—ãŸæ™‚ã®å‡¦ç†
        alert('Error:' + JSON.stringify(error));

      }).always((data) => {// å¸¸ã«ã‚„ã‚‹å‡¦ç†
        // do something
        // enableControlElements();
      });
    }
    flashcardYomikomi();  // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆèª­ã¿è¾¼ã¿
    const synth = window.speechSynthesis;
    const sheetSelector = document.getElementById("sheet-select");
    let currentIndex = 0;
    let correctCount = 0;
    let incorrectCount = 0;
    const totalGrade = document.querySelector('.totalGrade');
    // åˆæœŸåŒ–
    let button = document.getElementById('chkInput');
    button.addEventListener('click', checkAnswer);

    // ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
    function showFlashcard() {
      let flashcard = flashCards[currentIndex];
      let imgElement = document.getElementById('flashcard-image');
      let comment = document.getElementById('comment');

      // ç”»åƒã¨çµæœã‚’ãƒªã‚»ãƒƒãƒˆ
      imgElement.src = flashcard[4];
      comment.textContent = '';
      answerJp.textContent = '';
      answerCh.textContent = '';
      answerPin.textContent = '';
      answerElement.value = '';
      answerElement.focus();
    }

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å›ç­”ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹é–¢æ•°
    function checkAnswer(e) {
      e.preventDefault();
      let flashcard = flashCards[currentIndex];
      
      let comment = document.getElementById('comment');

      answerJp.textContent = flashcard[1];
      answerCh.textContent = flashcard[2];
      answerPin.textContent = flashcard[3];
      if (button.textContent === 'check') {
        speakText2(flashcard[2]);
        button.textContent = 'next';
        // å›ç­”ãŒæ­£ã—ã„ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯
        if (flashcard[2] === answerElement.value) {
          comment.textContent = 'å¥½ï¼èµğŸ‘';
          speakText2(comment.textContent);
          console.log('seikai')
          correctCount++;
        } else {
          comment.textContent = `é”™Ã—ã€€å†åŠ æ²¹ï¼ï¼ ${flashcard[2]}`;
          speakText2(comment.textContent);
          console.log('fuseikai');
          incorrectCount++;
        }


        displayResult();

      } else {

        // æ¬¡ã®ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰ã«é€²ã‚€
        currentIndex++;
        if (currentIndex === flashCards.length) {

          totalGrade.classList.add('totalGradeDisplay');
          totalGrade.classList.remove('totalGradeNoDisplay');
          let totalSeitouritsu = document.getElementById('totalSeitouritsu');
          let totalComment = document.getElementById('totalComment');
          let mondaisu = flashCards.length;
          let ritsu = correctCount * 100 / mondaisu;
          totalSeitouritsu.textContent = `æ­£ç­”æ•°ã¯${correctCount}, æ­£ç­”ç‡ã¯${ritsu.toFixed(1)}ã§ã—ãŸã€‚`;
          if (correctCount === mondaisu) {

            totalComment.textContent = 'æ­å–œæ­å–œ!!';

            speakText2('æ­å–œæ­å–œ!!');
          } else {
            totalComment.textContent = '';

          }



        } else {
          button.textContent = 'check';
          answerElement.value = '';
          showFlashcard();

        }

      }

    }
    // ãƒ†ã‚­ã‚¹ãƒˆã‚’éŸ³å£°ã«å¤‰æ›ã—ã¦å†ç”Ÿã™ã‚‹é–¢æ•°
    function speakText1(parm) {
      let text = parm.textContent;
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'zh-CN'; // ä¸­å›½èªã®è¨€èªã‚³ãƒ¼ãƒ‰
      synth.speak(utterance);
    }
    // ãƒ†ã‚­ã‚¹ãƒˆã‚’éŸ³å£°ã«å¤‰æ›ã—ã¦å†ç”Ÿã™ã‚‹é–¢æ•°
    function speakText2(text) {

      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'zh-CN'; // ä¸­å›½èªã®è¨€èªã‚³ãƒ¼ãƒ‰
      synth.speak(utterance);
    }
    // çµæœã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
    function displayResult() {
      result.textContent = `æ­£è§£: ${correctCount} å› ä¸æ­£è§£: ${incorrectCount} å›`;
    }
    // ã‚·ãƒ¼ãƒˆé¸æŠã•ã‚ŒãŸã¨ãã®å‡¦ç†
    let select = document.querySelector('[name="sheetSelect"]');

    select.onchange = event => {
      var selIndex = select.selectedIndex;
      sheetIndex = selIndex;
      console.log(select.selectedIndex);

      flashCards = flashcardDatas[selIndex + 1];

      // flashCards2 = flashcardGenerate(flashCards);
      currentIndex = 0;
      correctCount = 0;
      incorrectCount = 0;
      button.textContent = 'check';
      answerElement.value = '';
      answerElement.focus();
      showFlashcard();
      displayResult();
      // flashcard.textContent = 'æŒ‰ä¸‹é”®çœ‹å•è¯å¡';
      totalGrade.classList.remove('totalGradeDisplay');
      totalGrade.classList.add('totalGradeNoDisplay');

    }
    // ã‚·ãƒ¼ãƒˆã®ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã€€ä½œæˆå‡¦ç†
    function setSheetNames(sheetNamesArray) {
      sheetSelector.innerChinese = "";
      document.createElement('option')
      sheetNamesArray.forEach((sheetName, index) => {
        let option = document.createElement('option');
        option.setAttribute('value', index + 1);
        option.innerHTML = sheetName;
        sheetSelector.appendChild(option);
      });
    }




  </script>

</body>

</html>